<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Naviser</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="manifest" href="manifest.json">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#0f172a;
  color:#fff;
  display:flex;
  justify-content:center;
}

/* APP FRAME */
#app{
  width:100%;
  max-width:480px;
  padding:12px;
  position:relative;
}

/* MAP */
#map{
  height:55vh;
  border-radius:20px;
  overflow:hidden;
}

/* GLASS PANEL */
.panel{
  backdrop-filter:blur(14px);
  background:rgba(255,255,255,.15);
  border-radius:16px;
  padding:10px;
}

/* BUTTONS */
button{
  border:none;
  border-radius:12px;
  padding:8px;
  font-size:14px;
  cursor:pointer;
  margin:2px 0;
}

/* FLOATING ROUND BUTTONS */
.round{
  position:absolute;
  width:40px;
  height:40px;
  border-radius:50%;
  backdrop-filter:blur(14px);
  background:rgba(255,255,255,.18);
  color:white;
  z-index:3000;
}
#fullscreenToggle{top:10px;right:10px;}
#installBtn{top:60px;right:10px;display:none;}
#layersToggle{top:110px;right:10px;}

/* INFO */
#infoBox{
  margin-top:10px;
  font-size:13px;
  line-height:1.4;
}

/* TOOLBAR */
#toolbar{
  margin-top:10px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
#toolbar button{flex:1 1 48%;}

/* LAYERS PANEL */
#layersPanel{
  display:none;
  margin-top:10px;
}

/* FOOTER */
footer{
  text-align:center;
  font-size:12px;
  margin-top:18px;
  opacity:.6;
}

/* OFFLINE */
#offline{
  position:fixed;
  bottom:12px;
  left:50%;
  transform:translateX(-50%);
  background:#dc2626;
  padding:6px 14px;
  border-radius:20px;
  display:none;
  z-index:9000;
}

/* FULLSCREEN FIX */
#app:fullscreen{
  max-width:none;
  width:100vw;
  height:100vh;
  padding:0;
}
#app:fullscreen #map{
  height:100%;
  border-radius:0;
}
#app:fullscreen #toolbar,
#app:fullscreen footer{
  display:none;
}
#app:fullscreen #infoBox,
#app:fullscreen #layersPanel{
  position:absolute;
  left:10px;
  right:10px;
  z-index:4000;
}
#app:fullscreen #infoBox{bottom:10px;}
#app:fullscreen #layersPanel{top:60px;}
</style>
</head>

<body>

<div id="app">

<button id="fullscreenToggle" class="round">‚õ∂</button>
<button id="installBtn" class="round">‚¨áÔ∏è</button>
<button id="layersToggle" class="round">üó∫Ô∏è</button>

<div id="map"></div>

<div id="layersPanel" class="panel">
  <strong>Map Variations</strong><br>
  <button onclick="setLayer('osm')">üó∫Ô∏è Standard</button>
  <button onclick="setLayer('sat')">üõ∞Ô∏è Satellite</button>
  <button onclick="setLayer('terrain')">üåÑ Terrain</button>
  <button onclick="setLayer('topo')">üß≠ Topographic</button>
  <button onclick="setLayer('dark')">üåô Dark Map</button>
</div>

<div id="infoBox" class="panel">
  <div id="locInfo">Waiting for GPS‚Ä¶</div>
  <div id="distInfo">Distance: 0 km</div>
</div>

<div id="toolbar" class="panel">
  <button onclick="addMarker()">‚ûï Add Marker</button>
  <button onclick="removeMarker()">‚ûñ Remove Marker</button>
  <button onclick="toggleUnit()">üìè KM / Mile</button>
</div>

<footer>¬© Manik Roy 2025. All Rights Reserved.</footer>
</div>

<div id="offline">Offline Mode</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
let map,userMarker,markers=[],line,km=true,activeLayer;

/* MAP LAYERS (NO API KEY) */
const layers={
 osm:L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}),
 sat:L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}',{maxZoom:19}),
 terrain:L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png',{maxZoom:17}),
 topo:L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',{maxZoom:19}),
 dark:L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}.png',{maxZoom:19})
};

map=L.map('map',{center:[20,78],zoom:5,layers:[layers.osm]});
activeLayer=layers.osm;

/* LAYER SWITCH */
function setLayer(name){
 map.removeLayer(activeLayer);
 activeLayer=layers[name];
 map.addLayer(activeLayer);
 layersPanel.style.display='none';
}
layersToggle.onclick=()=>{
 layersPanel.style.display=layersPanel.style.display==='none'?'block':'none';
};

/* GEOLOCATION */
navigator.geolocation.watchPosition(p=>{
 const c=p.coords;
 if(!userMarker){
  userMarker=L.marker([c.latitude,c.longitude]).addTo(map);
  map.setView([c.latitude,c.longitude],15);
 }else userMarker.setLatLng([c.latitude,c.longitude]);

 locInfo.innerHTML=
  `Lat: ${c.latitude.toFixed(5)}<br>
   Lng: ${c.longitude.toFixed(5)}<br>
   Accuracy: ${c.accuracy} m<br>
   Altitude: ${c.altitude ?? 'N/A'}`;
},{enableHighAccuracy:true});

/* MARKERS */
function addMarker(){
 const m=L.marker(map.getCenter(),{draggable:true}).addTo(map);
 m.on('drag',calcDistance);
 markers.push(m);
 calcDistance();
}
function removeMarker(){
 if(markers.length){
  map.removeLayer(markers.pop());
  calcDistance();
 }
}

/* DISTANCE */
function calcDistance(){
 if(line) map.removeLayer(line);
 if(markers.length<2){distInfo.innerText='Distance: 0';return;}
 line=L.polyline(markers.map(m=>m.getLatLng())).addTo(map);
 let d=0;
 for(let i=1;i<markers.length;i++)
  d+=markers[i-1].getLatLng().distanceTo(markers[i].getLatLng());
 distInfo.innerText=`Distance: ${(km?d/1000:d/1609).toFixed(2)} ${km?'km':'mile'}`;
}
function toggleUnit(){km=!km;calcDistance();}

/* FULLSCREEN */
fullscreenToggle.onclick=()=>{
 const app=document.getElementById('app');
 !document.fullscreenElement?app.requestFullscreen():document.exitFullscreen();
};
document.addEventListener('fullscreenchange',()=>setTimeout(()=>map.invalidateSize(),300));

/* OFFLINE */
function net(){offline.style.display=navigator.onLine?'none':'block';}
window.addEventListener('online',net);
window.addEventListener('offline',net);
net();

/* PWA */
let deferredPrompt;
window.addEventListener('beforeinstallprompt',e=>{
 e.preventDefault();
 deferredPrompt=e;
 installBtn.style.display='block';
});
installBtn.onclick=async()=>{
 deferredPrompt.prompt();
 await deferredPrompt.userChoice;
 deferredPrompt=null;
 installBtn.style.display='none';
};

if('serviceWorker' in navigator)
 navigator.serviceWorker.register('sw.js');
</script>

</body>
</html>
