<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Naviser GPS Pro</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.css"/>

<style>
body{margin:0;background:#0b1220;color:#fff;font-family:system-ui}
#app{max-width:480px;margin:auto;padding:8px}
#map{height:60vh;border-radius:16px}
.panel{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);
border-radius:14px;padding:8px;margin-top:6px;font-size:13px}
button,select{width:100%;margin-top:4px;padding:8px;border-radius:10px;
border:none;background:#1e293b;color:#fff}
footer{text-align:center;font-size:11px;opacity:.6;margin-top:8px}
</style>
</head>

<body>
<div id="app">

<div id="map"></div>

<div class="panel">
<select id="mapStyle">
<option value="street">Street</option>
<option value="sat">Satellite</option>
<option value="terrain">Terrain</option>
<option value="hybrid">Hybrid</option>
</select>

<button id="gpsBtn">ğŸ“¡ Enable GPS</button>
<button id="followBtn">ğŸ“ Follow: ON</button>

<div id="gpsStatus">Waiting for GPSâ€¦</div>
<div id="loc"></div>
<div id="speed"></div>
<div id="heading"></div>

<button id="addMarkerBtn">â• Add Marker</button>
<button id="removeMarkerBtn">â– Remove Marker</button>

<button id="startPoly">ğŸ“ Start Area</button>
<button id="clearPoly">âŒ Clear Area</button>

<div id="distance"></div>
<div id="area"></div>
</div>

<footer>Â© Manik Roy 2026</footer>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.js"></script>

<script>
let map=L.map('map',{fullscreenControl:true})
.setView([20,78],5);

// --- MAP LAYERS ---
let layers={
street:L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png'),
sat:L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}'),
terrain:L.tileLayer('https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png'),
hybrid:L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}')
};
layers.street.addTo(map);

// --- VARIABLES ---
let userMarker,watchId,follow=true;
let markers=[],line;
let polyPoints=[],poly,linePoly;

// --- MAP STYLE SWITCH ---
mapStyle.onchange=()=>{
map.eachLayer(l=>map.removeLayer(l));
layers[mapStyle.value].addTo(map);
if(userMarker) userMarker.addTo(map);
if(line) line.addTo(map);
if(poly) poly.addTo(map);
};

// --- FOLLOW LOGIC ---
followBtn.onclick=()=>{
follow=!follow;
followBtn.innerText="ğŸ“ Follow: "+(follow?"ON":"OFF");
}
map.on('dragstart zoomstart',()=>{
follow=false;
followBtn.innerText="ğŸ“ Follow: OFF";
});

// --- GPS ---
gpsBtn.onclick=startGPS;

function startGPS(){
gpsStatus.innerText="ğŸ“¡ Searchingâ€¦";
gpsBtn.style.display="none";

watchId=navigator.geolocation.watchPosition(pos=>{
let c=pos.coords;
gpsStatus.innerText="âœ… GPS Active";

if(!userMarker){
userMarker=L.marker([c.latitude,c.longitude]).addTo(map);
if(follow) map.setView([c.latitude,c.longitude],16);
}else{
userMarker.setLatLng([c.latitude,c.longitude]);
if(follow) map.panTo([c.latitude,c.longitude]);
}

loc.innerText=`ğŸ“ ${c.latitude.toFixed(5)}, ${c.longitude.toFixed(5)}`;
speed.innerText=`ğŸš€ Speed: ${(c.speed?c.speed*3.6:0).toFixed(1)} km/h`;
heading.innerText=`ğŸ§­ Heading: ${c.heading?c.heading.toFixed(0):"N/A"}Â°`;

},err=>{
gpsStatus.innerText="âŒ GPS Denied";
gpsBtn.style.display="block";
},{enableHighAccuracy:true});
}

// --- MARKERS + DISTANCE ---
addMarkerBtn.onclick=()=>{
let m=L.marker(map.getCenter(),{draggable:true}).addTo(map);
m.on('drag',calcDist);
markers.push(m);
calcDist();
}
removeMarkerBtn.onclick=()=>{
if(markers.length){
map.removeLayer(markers.pop());
calcDist();
}
}

function calcDist(){
if(line) map.removeLayer(line);
if(markers.length>1){
line=L.polyline(markers.map(m=>m.getLatLng())).addTo(map);
let d=0;
for(let i=1;i<markers.length;i++)
d+=markers[i-1].getLatLng().distanceTo(markers[i].getLatLng());
distance.innerText=`ğŸ“ Distance: ${(d/1000).toFixed(2)} km`;
}else distance.innerText="";
}

// --- AREA MEASUREMENT ---
startPoly.onclick=()=>{
map.once('click',e=>{
polyPoints.push(e.latlng);
drawPoly();
startPoly.click();
});
}
clearPoly.onclick=()=>{
polyPoints=[];
if(poly) map.removeLayer(poly);
area.innerText="";
}

function drawPoly(){
if(poly) map.removeLayer(poly);
poly=L.polygon(polyPoints).addTo(map);

if(polyPoints.length>2){
let a=L.GeometryUtil.geodesicArea(polyPoints);
area.innerText=`ğŸ“ Area: ${(a/1000000).toFixed(3)} kmÂ²`;
}
}
</script>
</body>
</html>
